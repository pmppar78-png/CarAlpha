<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Car Alpha — Free VIN Lookup & Smart Report</title>
  <meta name="description" content="Free VIN lookup with recalls & specs plus AI that explains next steps: insurance savings, warranty value, repairs, loans/refi, lemon-law options and more." />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            carbon: { 50:'#f6f7f8', 100:'#ebedf0', 200:'#d3d7de', 300:'#b0b8c4', 400:'#8692a3', 500:'#647080', 600:'#4a5568', 700:'#1e2530', 800:'#13181f', 900:'#0d1117', 950:'#080b0f' },
            volt: { 300:'#67e8f9', 400:'#22d3ee', 500:'#06b6d4', 600:'#0891b2', 700:'#0e7490' },
            silver: { 300:'#c0c7d0', 400:'#a0aab8', 500:'#7e8a9a' },
            steel: { 400:'#94a3b8', 500:'#64748b' }
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
    body { font-family: 'Inter', system-ui, -apple-system, sans-serif; }

    /* === CARBON FIBER WEAVE TEXTURE === */
    .carbon-bg {
      background-color: #0a0d12;
      position: relative;
    }
    .carbon-bg::before {
      content: '';
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
      opacity: 0.032;
      background-image:
        /* Diagonal weave - first direction */
        repeating-linear-gradient(
          45deg,
          transparent,
          transparent 2px,
          rgba(255,255,255,0.4) 2px,
          rgba(255,255,255,0.4) 3px,
          transparent 3px,
          transparent 6px
        ),
        /* Diagonal weave - second direction */
        repeating-linear-gradient(
          -45deg,
          transparent,
          transparent 2px,
          rgba(255,255,255,0.35) 2px,
          rgba(255,255,255,0.35) 3px,
          transparent 3px,
          transparent 6px
        ),
        /* Subtle highlight at intersections */
        repeating-linear-gradient(
          45deg,
          transparent,
          transparent 5px,
          rgba(255,255,255,0.15) 5px,
          rgba(255,255,255,0.15) 6px,
          transparent 6px,
          transparent 12px
        );
      background-size: 8px 8px, 8px 8px, 12px 12px;
    }
    .carbon-bg > * { position: relative; z-index: 1; }

    .carbon-panel {
      background-color: rgba(13,17,23,0.7);
      position: relative;
    }
    .carbon-panel::after {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      pointer-events: none;
      opacity: 0.025;
      background-image:
        repeating-linear-gradient(
          45deg,
          transparent,
          transparent 2px,
          rgba(255,255,255,0.4) 2px,
          rgba(255,255,255,0.4) 3px,
          transparent 3px,
          transparent 6px
        ),
        repeating-linear-gradient(
          -45deg,
          transparent,
          transparent 2px,
          rgba(255,255,255,0.35) 2px,
          rgba(255,255,255,0.35) 3px,
          transparent 3px,
          transparent 6px
        );
      background-size: 8px 8px;
    }

    /* === GLASSMORPHISM === */
    .glass-dark {
      backdrop-filter: blur(20px) saturate(1.6);
      background: rgba(10,13,18,0.88);
      border-bottom: 1px solid rgba(6,182,212,0.08);
    }
    .glass-card {
      backdrop-filter: blur(16px);
      background: linear-gradient(135deg, rgba(19,24,31,0.85) 0%, rgba(13,17,23,0.9) 100%);
      border: 1px solid rgba(6,182,212,0.1);
      position: relative;
    }

    /* === METALLIC GRADIENT BORDERS === */
    .metallic-border {
      position: relative;
      border: 1px solid transparent;
      background-clip: padding-box;
    }
    .metallic-border::before {
      content: '';
      position: absolute;
      inset: -1px;
      border-radius: inherit;
      background: linear-gradient(135deg, rgba(6,182,212,0.3) 0%, rgba(148,163,184,0.15) 30%, rgba(6,182,212,0.2) 50%, rgba(148,163,184,0.1) 70%, rgba(6,182,212,0.25) 100%);
      z-index: -1;
      mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      mask-composite: exclude;
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      padding: 1px;
    }

    /* === GLOW EFFECTS === */
    .glow-cyan { box-shadow: 0 0 40px rgba(6,182,212,0.15), 0 0 80px rgba(6,182,212,0.06), 0 8px 32px rgba(0,0,0,0.4); }
    .glow-cyan-sm { box-shadow: 0 0 20px rgba(6,182,212,0.1), 0 4px 16px rgba(0,0,0,0.3); }
    .glow-cyan-intense { box-shadow: 0 0 50px rgba(6,182,212,0.25), 0 0 100px rgba(6,182,212,0.1), 0 8px 40px rgba(0,0,0,0.5); }
    .shadow-premium { box-shadow: 0 25px 80px rgba(0,0,0,0.5), 0 8px 24px rgba(0,0,0,0.3); }
    .shadow-card { box-shadow: 0 12px 40px rgba(0,0,0,0.35), 0 4px 12px rgba(0,0,0,0.2); }

    /* === BORDER GLOWS === */
    .border-glow { border: 1px solid rgba(6,182,212,0.15); }
    .border-glow-strong { border: 1px solid rgba(6,182,212,0.35); }

    /* === GRADIENT EFFECTS === */
    .gradient-mesh {
      background:
        radial-gradient(ellipse 90% 50% at 50% -20%, rgba(6,182,212,0.1) 0%, transparent 60%),
        radial-gradient(ellipse 50% 40% at 85% 50%, rgba(6,182,212,0.05) 0%, transparent 50%),
        radial-gradient(ellipse 40% 30% at 15% 60%, rgba(6,182,212,0.03) 0%, transparent 50%);
    }

    /* Slow ambient light sweep for hero depth */
    @keyframes hero-sweep {
      0% { opacity: 0.03; transform: translateX(-30%) skewX(-15deg); }
      50% { opacity: 0.07; transform: translateX(30%) skewX(-15deg); }
      100% { opacity: 0.03; transform: translateX(-30%) skewX(-15deg); }
    }
    .hero-sweep {
      position: absolute;
      inset: -20% -50%;
      background: linear-gradient(90deg, transparent 0%, rgba(6,182,212,0.15) 30%, rgba(255,255,255,0.04) 50%, rgba(6,182,212,0.15) 70%, transparent 100%);
      animation: hero-sweep 12s ease-in-out infinite;
      pointer-events: none;
    }
    .text-gradient {
      background: linear-gradient(135deg, #67e8f9 0%, #06b6d4 40%, #22d3ee 70%, #67e8f9 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .text-gradient-steel {
      background: linear-gradient(135deg, #e2e8f0 0%, #94a3b8 50%, #cbd5e1 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* === BUTTONS === */
    .btn-primary {
      background: linear-gradient(135deg, #06b6d4 0%, #0891b2 50%, #0e7490 100%);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 20px rgba(6,182,212,0.2), inset 0 1px 0 rgba(255,255,255,0.1);
    }
    .btn-primary:hover {
      background: linear-gradient(135deg, #22d3ee 0%, #06b6d4 50%, #0891b2 100%);
      box-shadow: 0 0 36px rgba(6,182,212,0.35), 0 8px 24px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.15);
      transform: translateY(-2px);
    }
    .btn-ghost {
      border: 1px solid rgba(6,182,212,0.2);
      background: rgba(6,182,212,0.04);
      transition: all 0.25s ease;
    }
    .btn-ghost:hover {
      border-color: rgba(6,182,212,0.45);
      background: rgba(6,182,212,0.1);
      box-shadow: 0 0 16px rgba(6,182,212,0.08);
    }

    /* === INPUT === */
    .input-premium {
      background: rgba(10,13,18,0.7);
      border: 1px solid rgba(6,182,212,0.15);
      transition: all 0.3s ease;
    }
    .input-premium:focus {
      border-color: rgba(6,182,212,0.6);
      box-shadow: 0 0 0 3px rgba(6,182,212,0.15), 0 0 30px rgba(6,182,212,0.18), 0 0 60px rgba(6,182,212,0.06), inset 0 0 20px rgba(6,182,212,0.03);
      outline: none;
      background: rgba(10,13,18,0.85);
    }

    /* === SCROLLBAR === */
    .scrollbox { max-height: 380px; overflow-y: auto; scrollbar-width: thin; scrollbar-color: rgba(6,182,212,0.2) transparent; }
    .scrollbox::-webkit-scrollbar { width: 4px; }
    .scrollbox::-webkit-scrollbar-track { background: transparent; }
    .scrollbox::-webkit-scrollbar-thumb { background: rgba(6,182,212,0.2); border-radius: 4px; }

    /* === DIVIDER === */
    .divider { height: 1px; background: linear-gradient(90deg, transparent, rgba(6,182,212,0.12), rgba(148,163,184,0.08), rgba(6,182,212,0.12), transparent); }

    /* === CARD HOVER === */
    .card-hover { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    .card-hover:hover {
      border-color: rgba(6,182,212,0.35);
      transform: translateY(-3px);
      box-shadow: 0 16px 48px rgba(0,0,0,0.4), 0 0 24px rgba(6,182,212,0.08);
    }

    /* === FEATURE ICON === */
    .feature-icon {
      background: linear-gradient(135deg, rgba(6,182,212,0.12) 0%, rgba(6,182,212,0.04) 100%);
      border: 1px solid rgba(6,182,212,0.15);
      box-shadow: 0 0 12px rgba(6,182,212,0.06);
    }

    /* === ANIMATIONS === */
    .pulse-dot { animation: pulse-glow 2s ease-in-out infinite; }
    @keyframes pulse-glow { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }

    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .animate-in { animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards; }

    @keyframes ai-pulse {
      0%, 100% { box-shadow: 0 0 24px rgba(6,182,212,0.25), 0 0 48px rgba(6,182,212,0.08), 0 4px 16px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.1); }
      50% { box-shadow: 0 0 40px rgba(6,182,212,0.4), 0 0 72px rgba(6,182,212,0.15), 0 4px 16px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.15); }
    }
    .ai-btn-glow {
      animation: ai-pulse 3s ease-in-out infinite;
      border: 1px solid rgba(6,182,212,0.3);
    }
    .ai-btn-glow:hover {
      transform: translateY(-4px) scale(1.03);
      box-shadow: 0 0 48px rgba(6,182,212,0.45), 0 0 90px rgba(6,182,212,0.18), 0 12px 32px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.2);
      border-color: rgba(6,182,212,0.5);
      animation: none;
    }
    .ai-btn-glow:active {
      transform: translateY(-1px) scale(1.01);
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    .shimmer-effect {
      position: relative;
      overflow: hidden;
    }
    .shimmer-effect::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.06) 40%, rgba(255,255,255,0.12) 50%, rgba(255,255,255,0.06) 60%, transparent 100%);
      background-size: 200% 100%;
      animation: shimmer 4s ease-in-out infinite;
      pointer-events: none;
      border-radius: inherit;
    }

    @keyframes border-glow-pulse {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }

    @keyframes scanline {
      0% { transform: translateY(-100%); }
      100% { transform: translateY(100%); }
    }

    @keyframes float-up {
      0% { opacity: 0; transform: translateY(30px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    .float-up-1 { animation: float-up 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards; animation-delay: 0.1s; opacity: 0; }
    .float-up-2 { animation: float-up 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards; animation-delay: 0.25s; opacity: 0; }
    .float-up-3 { animation: float-up 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards; animation-delay: 0.4s; opacity: 0; }

    /* === VIN CARD GLOW EDGE === */
    .vin-card {
      position: relative;
    }
    .vin-card::before {
      content: '';
      position: absolute;
      inset: -2px;
      border-radius: 1.1rem;
      background: linear-gradient(135deg, rgba(6,182,212,0.4) 0%, rgba(148,163,184,0.1) 25%, rgba(6,182,212,0.3) 50%, rgba(148,163,184,0.1) 75%, rgba(6,182,212,0.35) 100%);
      z-index: -1;
      animation: border-glow-pulse 3s ease-in-out infinite;
    }

    /* === AI MODAL === */
    .ai-modal-overlay { position: fixed; inset: 0; z-index: 100; background: rgba(0,0,0,0.7); backdrop-filter: blur(8px); display: none; }
    .ai-modal-overlay.active { display: flex; align-items: center; justify-content: center; }
    @media (max-width: 767px) {
      .ai-modal-overlay.active { align-items: flex-end; }
      .ai-modal { border-radius: 1.25rem 1.25rem 0 0 !important; max-height: 90vh !important; width: 100% !important; max-width: 100% !important; }
    }

    /* === HEADER SCANLINE === */
    .header-line {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(6,182,212,0.3), rgba(6,182,212,0.6), rgba(6,182,212,0.3), transparent);
    }

    /* === PERFORMANCE GRID LINES === */
    .perf-grid::before {
      content: '';
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(rgba(6,182,212,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(6,182,212,0.03) 1px, transparent 1px);
      background-size: 60px 60px;
      mask: radial-gradient(ellipse 70% 50% at 50% 30%, black, transparent);
      -webkit-mask: radial-gradient(ellipse 70% 50% at 50% 30%, black, transparent);
    }

    /* === BRUSHED STEEL CARD HEADER === */
    .steel-header {
      background: linear-gradient(135deg, rgba(148,163,184,0.08) 0%, rgba(100,116,139,0.04) 50%, rgba(148,163,184,0.06) 100%);
      border-bottom: 1px solid rgba(148,163,184,0.08);
    }
  </style>
</head>
<body class="min-h-screen carbon-bg text-gray-200 antialiased">
<script>
const AFFILIATES = {
  insurance: "https://example.com/aff/insurance?vin={{VIN}}",
  warranty:  "https://example.com/aff/warranty?vin={{VIN}}",
  loans:     "https://example.com/aff/loans?vin={{VIN}}",
  sell:      "https://example.com/aff/sell?vin={{VIN}}",
  mechanics: "https://example.com/aff/mechanics?vin={{VIN}}",
  lemonlaw:  "https://example.com/aff/lemon?vin={{VIN}}"
};
</script>

<!-- ========== HEADER ========== -->
<header class="sticky top-0 z-50 glass-dark">
  <div class="header-line"></div>
  <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
    <!-- Logo -->
    <a href="/" class="flex items-center gap-3 group">
      <div class="relative h-10 w-10 rounded-xl bg-gradient-to-br from-volt-500 to-volt-700 grid place-items-center text-white font-black text-lg shadow-lg shadow-volt-500/25">
        A
        <div class="absolute inset-0 rounded-xl ring-1 ring-white/15"></div>
      </div>
      <div>
        <div class="text-xl font-extrabold tracking-tight text-white">Car <span class="text-gradient">Alpha</span></div>
        <div class="text-[10px] font-semibold text-steel-400 tracking-widest uppercase -mt-0.5">Vehicle Intelligence Platform</div>
      </div>
    </a>

    <!-- Nav + AI Button -->
    <div class="flex items-center gap-3">
      <nav class="hidden md:flex items-center gap-5 text-sm font-medium text-silver-400 mr-4">
        <a href="#features" class="hover:text-volt-400 transition-colors duration-300">Features</a>
        <a href="#about" class="hover:text-volt-400 transition-colors duration-300">About</a>
        <a href="#legal" class="hover:text-volt-400 transition-colors duration-300">Legal</a>
      </nav>

      <!-- ===== AI BUTTON — DOMINANT ===== -->
      <button id="openAI" class="group relative flex items-center gap-2.5 px-5 py-3 rounded-xl btn-primary ai-btn-glow shimmer-effect text-white text-sm font-bold tracking-wide" style="transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);">
        <svg class="w-5 h-5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.455 2.456L21.75 6l-1.036.259a3.375 3.375 0 00-2.455 2.456z"/></svg>
        <div class="flex flex-col items-start leading-tight">
          <span class="text-sm font-bold">Ask Car Alpha AI</span>
          <span class="hidden lg:block text-[10px] font-medium text-cyan-200/60 tracking-wide">Recalls &middot; Warranty &middot; Lemon Law &middot; Insurance &middot; Repairs</span>
        </div>
      </button>
    </div>
  </div>
</header>

<!-- ========== HERO + VIN SECTION ========== -->
<section class="relative overflow-hidden">
  <!-- Background effects -->
  <div class="absolute inset-0 gradient-mesh"></div>
  <div class="absolute inset-0 perf-grid"></div>
  <div class="hero-sweep"></div>
  <div class="absolute top-0 left-1/2 -translate-x-1/2 w-[1000px] h-[700px] bg-volt-500/[0.03] rounded-full blur-3xl"></div>
  <div class="absolute top-20 right-0 w-[400px] h-[400px] bg-volt-600/[0.02] rounded-full blur-3xl"></div>

  <div class="relative max-w-6xl mx-auto px-4 pt-20 pb-24 md:pt-28 md:pb-32">
    <div class="max-w-3xl mx-auto text-center">
      <!-- Badge -->
      <div class="inline-flex items-center gap-2.5 px-5 py-2 rounded-full border border-volt-500/20 bg-volt-500/[0.06] text-xs font-semibold text-volt-400 mb-8 float-up-1">
        <span class="w-2 h-2 rounded-full bg-volt-400 pulse-dot shadow-sm shadow-volt-400/50"></span>
        Powered by Official NHTSA Data
      </div>

      <!-- Headline -->
      <h2 class="text-4xl md:text-5xl lg:text-[3.75rem] font-black tracking-tight leading-[1.08] float-up-2">
        <span class="text-white drop-shadow-lg">Decode Any VIN.</span><br/>
        <span class="text-gradient">Instant Intelligence.</span>
      </h2>
      <p class="mt-6 text-lg md:text-xl text-silver-400 max-w-2xl mx-auto leading-relaxed float-up-3">
        Free recalls, full specs, and an AI co-pilot that explains your next steps &mdash; insurance, warranty, repairs, lemon law, and more.
      </p>

      <!-- VIN Input Card -->
      <div id="vin" class="vin-card mt-12 glass-card rounded-2xl p-6 md:p-8 glow-cyan max-w-xl mx-auto carbon-panel float-up-3">
        <label class="block text-sm font-bold text-silver-300 text-left mb-3 tracking-wide uppercase">Enter your 17-character VIN</label>
        <div class="flex flex-col sm:flex-row gap-3">
          <input id="vinInput" maxlength="17" placeholder="e.g., 1HGCM82633A004352"
            class="flex-1 px-5 py-4 rounded-xl input-premium text-white placeholder-silver-500 text-base font-mono tracking-wider" />
          <button id="runBtn" class="px-8 py-4 rounded-xl btn-primary text-white font-bold text-base whitespace-nowrap tracking-wide">
            Get Report
          </button>
        </div>
        <p class="mt-3 text-xs text-silver-500/70 text-left">Your VIN is used once to fetch public data. We never store it.</p>
      </div>

      <!-- Trust badges -->
      <div class="mt-10 flex flex-wrap items-center justify-center gap-7 text-xs font-semibold text-silver-500 float-up-3">
        <div class="flex items-center gap-2">
          <svg class="w-4 h-4 text-volt-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z"/></svg>
          100% Free
        </div>
        <div class="flex items-center gap-2">
          <svg class="w-4 h-4 text-volt-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"/></svg>
          Official NHTSA Data
        </div>
        <div class="flex items-center gap-2">
          <svg class="w-4 h-4 text-volt-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1121.75 8.25z"/></svg>
          No Account Required
        </div>
      </div>
    </div>

    <!-- Results area -->
    <section class="mt-12 max-w-3xl mx-auto space-y-5">
      <div class="hidden" id="loading">
        <div class="glass-card rounded-2xl p-6 border-glow text-center carbon-panel">
          <div class="inline-flex items-center gap-3 text-silver-300">
            <svg class="animate-spin w-5 h-5 text-volt-400" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg>
            Fetching official NHTSA data...
          </div>
        </div>
      </div>
      <div class="hidden" id="errorBox">
        <div class="p-5 rounded-2xl border border-red-500/30 bg-red-500/10 text-red-300 shadow-card" id="errorText">Error</div>
      </div>
      <div class="hidden" id="vehicleCard"></div>
      <div class="hidden" id="recallCard"></div>
      <div class="hidden" id="actionsCard"></div>
    </section>
  </div>
</section>

<!-- ========== FEATURES ========== -->
<section id="features" class="relative">
  <div class="divider"></div>
  <div class="max-w-6xl mx-auto px-4 py-24">
    <div class="text-center mb-14">
      <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full border border-volt-500/15 bg-volt-500/[0.04] text-xs font-semibold text-volt-400 mb-5 uppercase tracking-widest">Core Systems</div>
      <h3 class="text-3xl md:text-4xl lg:text-[2.75rem] font-black text-white tracking-tight">One Lookup. Complete Intelligence.</h3>
      <p class="mt-4 text-silver-400 max-w-lg mx-auto leading-relaxed">Everything you need to make confident vehicle decisions, powered by official data and smart AI.</p>
    </div>
    <div class="grid md:grid-cols-3 gap-5">
      <div class="glass-card metallic-border rounded-2xl overflow-hidden card-hover carbon-panel">
        <div class="steel-header px-6 py-4 flex items-center gap-3">
          <div class="feature-icon w-11 h-11 rounded-xl grid place-items-center">
            <svg class="w-5 h-5 text-volt-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 013.75 9.375v-4.5zM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 01-1.125-1.125v-4.5zM13.5 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0113.5 9.375v-4.5z"/><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 6.75h.75v.75h-.75v-.75zM6.75 16.5h.75v.75h-.75v-.75zM16.5 6.75h.75v.75h-.75v-.75zM13.5 13.5h.75v.75h-.75v-.75zM13.5 19.5h.75v.75h-.75v-.75zM19.5 13.5h.75v.75h-.75v-.75zM19.5 19.5h.75v.75h-.75v-.75zM16.5 16.5h.75v.75h-.75v-.75z"/></svg>
          </div>
          <h4 class="font-bold text-white text-lg tracking-tight">VIN Decode</h4>
        </div>
        <div class="px-6 py-5">
          <p class="text-sm text-silver-400 leading-relaxed">Official NHTSA specs: make, model, year, engine, trim, body style, drive type, and build plant &mdash; all decoded instantly.</p>
        </div>
      </div>
      <div class="glass-card metallic-border rounded-2xl overflow-hidden card-hover carbon-panel">
        <div class="steel-header px-6 py-4 flex items-center gap-3">
          <div class="feature-icon w-11 h-11 rounded-xl grid place-items-center">
            <svg class="w-5 h-5 text-volt-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"/></svg>
          </div>
          <h4 class="font-bold text-white text-lg tracking-tight">Recall Check</h4>
        </div>
        <div class="px-6 py-5">
          <p class="text-sm text-silver-400 leading-relaxed">Live NHTSA recall data with campaign details, consequences, and remedies. Know if your vehicle needs a free dealer fix.</p>
        </div>
      </div>
      <div class="glass-card metallic-border rounded-2xl overflow-hidden card-hover carbon-panel">
        <div class="steel-header px-6 py-4 flex items-center gap-3">
          <div class="feature-icon w-11 h-11 rounded-xl grid place-items-center">
            <svg class="w-5 h-5 text-volt-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.455 2.456L21.75 6l-1.036.259a3.375 3.375 0 00-2.455 2.456z"/></svg>
          </div>
          <h4 class="font-bold text-white text-lg tracking-tight">AI Co-Pilot</h4>
        </div>
        <div class="px-6 py-5">
          <p class="text-sm text-silver-400 leading-relaxed">ChatGPT-style assistant powered by OpenAI that delivers actionable guidance on insurance, warranty, repairs, loans, and lemon law.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ========== ABOUT ========== -->
<section id="about" class="relative">
  <div class="divider"></div>
  <div class="max-w-6xl mx-auto px-4 py-24">
    <div class="text-center mb-14">
      <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full border border-volt-500/15 bg-volt-500/[0.04] text-xs font-semibold text-volt-400 mb-5 uppercase tracking-widest">Platform</div>
      <h3 class="text-3xl md:text-4xl lg:text-[2.75rem] font-black text-white tracking-tight">About Car Alpha</h3>
      <p class="mt-4 text-silver-400 max-w-lg mx-auto leading-relaxed">Consumer-first vehicle intelligence. Fast, free, and built on trust.</p>
    </div>
    <div class="grid md:grid-cols-2 gap-5">
      <div class="glass-card metallic-border rounded-2xl overflow-hidden card-hover carbon-panel">
        <div class="steel-header px-7 py-4 flex items-center gap-3">
          <div class="feature-icon w-10 h-10 rounded-lg grid place-items-center">
            <svg class="w-5 h-5 text-volt-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m.94 3.198l.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0112 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 016 18.719m12 0a5.971 5.971 0 00-.941-3.197m0 0A5.995 5.995 0 0012 12.75a5.995 5.995 0 00-5.058 2.772m0 0a3 3 0 00-4.681 2.72 8.986 8.986 0 003.74.477m.94-3.197a5.971 5.971 0 00-.94 3.197M15 6.75a3 3 0 11-6 0 3 3 0 016 0zm6 3a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0zm-13.5 0a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"/></svg>
          </div>
          <h4 class="font-bold text-white text-lg">Who We Are</h4>
        </div>
        <div class="px-7 py-5">
          <p class="text-silver-400 text-sm leading-relaxed">Car Alpha is a consumer-first automotive intelligence platform. We believe vital car data should be fast, free, and easy to understand. We don't sell your information or gate basic safety data behind paywalls. We earn by recommending helpful next steps &mdash; insurance savings, fair-price warranties, mechanic estimates, refinancing options, and reputable marketplaces &mdash; only when you choose to click.</p>
        </div>
      </div>
      <div class="glass-card metallic-border rounded-2xl overflow-hidden card-hover carbon-panel">
        <div class="steel-header px-7 py-4 flex items-center gap-3">
          <div class="feature-icon w-10 h-10 rounded-lg grid place-items-center">
            <svg class="w-5 h-5 text-volt-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z"/></svg>
          </div>
          <h4 class="font-bold text-white text-lg">What We Offer</h4>
        </div>
        <div class="px-7 py-5">
          <ul class="space-y-3 text-silver-400 text-sm leading-relaxed">
            <li class="flex items-start gap-2.5"><svg class="w-4 h-4 text-volt-500 mt-0.5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5"/></svg>Instant, free VIN decode powered by official NHTSA sources</li>
            <li class="flex items-start gap-2.5"><svg class="w-4 h-4 text-volt-500 mt-0.5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5"/></svg>Make/Model/Year recall checks with NHTSA references</li>
            <li class="flex items-start gap-2.5"><svg class="w-4 h-4 text-volt-500 mt-0.5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5"/></svg>AI co-pilot with plain-English guidance tailored to your vehicle</li>
            <li class="flex items-start gap-2.5"><svg class="w-4 h-4 text-volt-500 mt-0.5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5"/></svg>Clear, optional actions with trusted partners &mdash; never required</li>
            <li class="flex items-start gap-2.5"><svg class="w-4 h-4 text-volt-500 mt-0.5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5"/></svg>No accounts, no emails, no storage of your VIN</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ========== LEGAL ========== -->
<section id="legal" class="relative">
  <div class="divider"></div>
  <div class="max-w-6xl mx-auto px-4 py-24">
    <div class="grid md:grid-cols-2 gap-5">
      <div class="glass-card metallic-border rounded-2xl overflow-hidden card-hover carbon-panel">
        <div class="steel-header px-7 py-4">
          <h4 class="font-bold text-white text-lg">Privacy Policy</h4>
        </div>
        <div class="px-7 py-5">
          <p class="text-sm text-silver-400 leading-relaxed">We do not collect or store VINs, search queries, or report outputs. Basic, anonymous analytics may measure usage to improve reliability. If you click a partner link, you will be subject to that partner's policies. We never sell personal data.</p>
        </div>
      </div>
      <div class="glass-card metallic-border rounded-2xl overflow-hidden card-hover carbon-panel">
        <div class="steel-header px-7 py-4">
          <h4 class="font-bold text-white text-lg">Terms of Service</h4>
        </div>
        <div class="px-7 py-5">
          <p class="text-sm text-silver-400 leading-relaxed">Car Alpha provides general information sourced from public datasets and partners and does not guarantee completeness or fitness for a particular purpose. Always verify details with a qualified professional. By using this site you agree that Car Alpha is not liable for decisions made based on this information.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ========== FOOTER ========== -->
<footer class="relative">
  <div class="divider"></div>
  <div class="max-w-6xl mx-auto px-4 py-10">
    <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
      <div>
        <div class="flex items-center gap-2">
          <div class="h-7 w-7 rounded-lg bg-gradient-to-br from-volt-500 to-volt-700 grid place-items-center text-white text-xs font-black shadow-md shadow-volt-500/20">A</div>
          <span class="font-bold text-white">Car Alpha</span>
        </div>
        <div class="text-xs text-silver-500 mt-1">&copy; <span id="year"></span> Car Alpha. All rights reserved.</div>
      </div>
      <div class="flex items-center gap-5 text-sm text-silver-500">
        <a href="#about" class="hover:text-volt-400 transition-colors duration-300">About</a>
        <a href="#legal" class="hover:text-volt-400 transition-colors duration-300">Privacy</a>
        <a href="#legal" class="hover:text-volt-400 transition-colors duration-300">Terms</a>
      </div>
    </div>
    <div class="mt-6 text-xs text-silver-500/50">
      Vehicle data sourced from NHTSA VPIC. Recall data from NHTSA Office of Defects Investigation. AI assistant powered by OpenAI.
    </div>
  </div>
</footer>

<!-- ========== AI CHAT MODAL (Command Center Style) ========== -->
<div id="aiOverlay" class="ai-modal-overlay">
  <div class="ai-modal w-full max-w-2xl rounded-2xl shadow-premium flex flex-col carbon-panel" style="max-height: 85vh; border: 1px solid rgba(6,182,212,0.15);">
    <!-- Modal Header -->
    <div class="flex items-center justify-between px-6 py-4" style="background: linear-gradient(135deg, rgba(6,182,212,0.08) 0%, rgba(13,17,23,0.9) 100%); border-bottom: 1px solid rgba(6,182,212,0.1);">
      <div class="flex items-center gap-3">
        <div class="relative h-10 w-10 rounded-xl bg-gradient-to-br from-volt-500 to-volt-700 grid place-items-center text-white font-bold text-sm shadow-lg shadow-volt-500/30">
          AI
          <div class="absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full bg-emerald-400 border-2 border-carbon-900 shadow-sm shadow-emerald-400/50"></div>
        </div>
        <div>
          <div class="font-bold text-white text-sm tracking-tight">Car Alpha AI</div>
          <div class="text-[11px] text-volt-400/70 font-medium">Recalls &middot; Warranty &middot; Insurance &middot; Lemon Law &middot; Next Steps</div>
        </div>
      </div>
      <button id="closeAI" class="p-2 rounded-lg hover:bg-white/[0.05] text-silver-400 hover:text-white transition-colors">
        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>

    <!-- Quick Actions -->
    <div class="px-6 py-3 border-b border-white/[0.04] flex flex-wrap gap-2">
      <button class="px-3 py-1.5 rounded-lg btn-ghost text-xs text-volt-400 font-medium" data-quick="recalls">Any recalls?</button>
      <button class="px-3 py-1.5 rounded-lg btn-ghost text-xs text-volt-400 font-medium" data-quick="insurance">Cheapest insurance?</button>
      <button class="px-3 py-1.5 rounded-lg btn-ghost text-xs text-volt-400 font-medium" data-quick="warranty">Worth getting warranty?</button>
      <button class="px-3 py-1.5 rounded-lg btn-ghost text-xs text-volt-400 font-medium" data-quick="mechanic">Repair estimates</button>
      <button class="px-3 py-1.5 rounded-lg btn-ghost text-xs text-volt-400 font-medium" data-quick="loans">Best loan/refi?</button>
      <button class="px-3 py-1.5 rounded-lg btn-ghost text-xs text-volt-400 font-medium" data-quick="lemon">Lemon law?</button>
    </div>

    <!-- Chat Messages -->
    <div id="chat" class="scrollbox flex-1 px-6 py-5 space-y-4 text-sm overflow-y-auto">
      <div class="flex items-start gap-3">
        <div class="shrink-0 h-7 w-7 rounded-lg bg-gradient-to-br from-volt-500 to-volt-700 text-white grid place-items-center text-[10px] font-bold shadow-md shadow-volt-500/20">AI</div>
        <div class="p-3.5 rounded-2xl rounded-tl-md bg-white/[0.04] border border-white/[0.06] text-silver-300 leading-relaxed max-w-[85%]">
          Welcome to Car Alpha AI. Run a VIN above for tailored guidance, or ask a general question &mdash; insurance, warranty, recalls, repairs, selling, loans, or lemon law. I'm here to help.
        </div>
      </div>
    </div>

    <!-- Input Area -->
    <div class="px-6 py-4" style="border-top: 1px solid rgba(6,182,212,0.08);">
      <div class="flex gap-3 items-end">
        <input id="chatInput" placeholder="Ask about insurance, warranty, recalls, repairs, lemon law..."
          class="flex-1 px-4 py-3 rounded-xl input-premium text-white placeholder-silver-500 text-sm" />
        <button id="chatSend" class="p-3 rounded-xl btn-primary text-white shrink-0">
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"/></svg>
        </button>
      </div>
      <div class="mt-2 flex items-center justify-between">
        <span class="text-[10px] text-silver-500/60">Powered by OpenAI &middot; ChatGPT-style intelligence</span>
        <span class="text-[10px] text-silver-500/40">We never sell your data</span>
      </div>
    </div>
  </div>
</div>

<!-- ========== JAVASCRIPT ========== -->
<script>
document.getElementById('year').textContent = new Date().getFullYear();

const qs = (s) => document.querySelector(s);
const vinInput = qs('#vinInput');
const runBtn   = qs('#runBtn');
const loading  = qs('#loading');
const errorBox = qs('#errorBox');
const errorText= qs('#errorText');
const vehicleCard = qs('#vehicleCard');
const recallCard  = qs('#recallCard');
const actionsCard = qs('#actionsCard');

// AI Modal
const aiOverlay = document.getElementById('aiOverlay');
const openAI    = document.getElementById('openAI');
const closeAI   = document.getElementById('closeAI');
const chat      = document.getElementById('chat');
const chatInput = document.getElementById('chatInput');
const chatSend  = document.getElementById('chatSend');

openAI.addEventListener('click', () => { aiOverlay.classList.add('active'); chatInput.focus(); });
closeAI.addEventListener('click', () => aiOverlay.classList.remove('active'));
aiOverlay.addEventListener('click', (e) => { if (e.target === aiOverlay) aiOverlay.classList.remove('active'); });
document.addEventListener('keydown', (e) => { if (e.key === 'Escape') aiOverlay.classList.remove('active'); });

function setLoading(on){ loading.classList.toggle('hidden', !on); }
function setError(msg){ if(!msg){ errorBox.classList.add('hidden'); return;} errorText.textContent = msg; errorBox.classList.remove('hidden'); }
function fillAffiliate(href, vin){ return href.replaceAll('{{VIN}}', encodeURIComponent(vin)); }

function postBubble(container, role, html){
  const isAI = role === 'ai';
  const wrap = document.createElement('div');
  wrap.className = 'flex items-start gap-3 animate-in';
  wrap.innerHTML = isAI
    ? `<div class="shrink-0 h-7 w-7 rounded-lg bg-gradient-to-br from-volt-500 to-volt-700 text-white grid place-items-center text-[10px] font-bold shadow-md shadow-volt-500/20">AI</div>
       <div class="p-3.5 rounded-2xl rounded-tl-md bg-white/[0.04] border border-white/[0.06] text-silver-300 leading-relaxed max-w-[85%]">${html}</div>`
    : `<div class="ml-auto p-3.5 rounded-2xl rounded-tr-md bg-volt-600/20 border border-volt-500/20 text-volt-200 leading-relaxed max-w-[85%]">${html}</div>`;
  container.appendChild(wrap);
  container.scrollTop = container.scrollHeight;
}

function CTA(label, key, vin){
  const href = fillAffiliate(AFFILIATES[key], vin || '');
  return `<a target="_blank" rel="nofollow sponsored noopener" href="${href}" class="inline-flex items-center gap-2 px-3.5 py-2 rounded-lg bg-volt-600/15 border border-volt-500/25 hover:border-volt-400/40 hover:bg-volt-600/25 text-volt-300 text-xs font-medium mt-2 mr-1 transition-all">${label} <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"/></svg></a>`;
}

let ctx = { vin: null, decoded: {}, recallCount: 0 };

function answer(q){
  const query = (q || '').toLowerCase();
  const c = ctx;
  const age = c.decoded?.ModelYear ? (new Date().getFullYear() - parseInt(c.decoded.ModelYear, 10)) : null;
  const make = c.decoded?.Make || 'this vehicle';
  const isEV = (c.decoded?.FuelTypePrimary || '').toLowerCase().includes('electric');

  if(query.includes('recall'))
    return c.recallCount > 0
      ? `We found <strong>${c.recallCount}</strong> recall(s) for ${make}. Book the <strong>free dealer fix</strong> first. ${CTA('Find a dealer','mechanics',c.vin)} ${CTA('Compare warranty options','warranty',c.vin)}`
      : `No recalls were found for ${make} based on the decoded year/model. Still, consider a quick inspection before purchase. ${CTA('Get mechanic estimates','mechanics',c.vin)}`;
  if(query.includes('warranty'))
    return age !== null && age >= 7
      ? `At about <strong>${age} years</strong> old, an extended warranty can be cost-effective. ${CTA('See warranty plans','warranty',c.vin)}`
      : `Warranty value depends on repair risk and mileage. Many owners use warranties for transmission/engine coverage. ${CTA('Check warranty quotes','warranty',c.vin)}`;
  if(query.includes('insurance'))
    return `${isEV ? 'EVs sometimes qualify for lower rates. ' : ''}Compare at least 3 carriers to save 10-30%. ${CTA('Compare insurance rates','insurance',c.vin)}`;
  if(query.includes('loan') || query.includes('refi') || query.includes('finance'))
    return `Better credit and newer vehicles often qualify for lower APR. Check offers with no hard pull first. ${CTA('Get loan/refi offers','loans',c.vin)}`;
  if(query.includes('mechanic') || query.includes('repair') || query.includes('estimate'))
    return `Get multiple quotes and check common issues for this model. ${CTA('Check mechanic estimates','mechanics',c.vin)}`;
  if(query.includes('sell') || query.includes('trade'))
    return `Instant-offer marketplaces can beat dealer trade-ins. ${CTA('Get an instant offer','sell',c.vin)}`;
  if(query.includes('lemon'))
    return `If repeated repairs affect safety or drivability, you may have remedies under state lemon laws. ${CTA('Check lemon-law options','lemonlaw',c.vin)}`;
  return `I can help with: <strong>recalls</strong>, <strong>insurance</strong>, <strong>warranty</strong>, <strong>loan/refi</strong>, <strong>repair estimates</strong>, <strong>selling</strong>, or <strong>lemon law</strong>. Run a VIN for tailored guidance.`;
}

function handleChat(inputEl, outEl){
  const text = inputEl.value || (typeof inputEl === 'string' ? inputEl : '');
  if (!text.trim()) return;
  postBubble(outEl, 'user', text);
  postBubble(outEl, 'ai', answer(text));
  if (inputEl.value !== undefined) inputEl.value = '';
}

chatSend.addEventListener('click', () => handleChat(chatInput, chat));
chatInput.addEventListener('keydown', e => { if(e.key === 'Enter') handleChat(chatInput, chat); });

document.querySelectorAll('[data-quick]').forEach(b => b.addEventListener('click', () => {
  handleChat({ value: b.textContent.trim() }, chat);
}));

// Robust fetch with timeout
function fetchJSON(url, timeoutMs = 10000){
  const controller = new AbortController();
  const t = setTimeout(() => controller.abort(), timeoutMs);
  return fetch(url, { signal: controller.signal })
    .then(r => { if(!r.ok) throw new Error('HTTP ' + r.status); return r.json(); })
    .finally(() => clearTimeout(t));
}

// VIN flow
async function runVIN(){
  setError();
  vehicleCard.classList.add('hidden');
  recallCard.classList.add('hidden');
  actionsCard.classList.add('hidden');
  const vin = (vinInput.value || '').trim().toUpperCase();
  if(vin.length !== 17){ setError('Please enter a valid 17-character VIN.'); return; }
  setLoading(true);
  try {
    const decodeUrl = `https://vpic.nhtsa.dot.gov/api/vehicles/DecodeVinValuesExtended/${vin}?format=json`;
    const dRes = await fetchJSON(decodeUrl, 12000);
    const decoded = (dRes.Results && dRes.Results[0]) || {};
    decoded.VIN = vin;
    renderVehicle(decoded);

    let recallCount = 0;
    try {
      const make = encodeURIComponent(decoded.Make || '');
      const model = encodeURIComponent(decoded.Model || '');
      const year = encodeURIComponent(decoded.ModelYear || '');
      if(make && model && year){
        const rUrl = `https://api.nhtsa.gov/recalls/recallsByVehicle?make=${make}&model=${model}&modelYear=${year}`;
        const rRes = await fetchJSON(rUrl, 12000);
        recallCount = renderRecalls(rRes) || 0;
      } else {
        recallCard.innerHTML = `<div class="glass-card metallic-border rounded-2xl p-6 carbon-panel"><h3 class="text-lg font-bold text-white">Recalls</h3><p class="mt-2 text-silver-400 text-sm">Could not determine make/model/year from VIN to fetch recalls.</p></div>`;
        recallCard.classList.remove('hidden');
      }
    } catch(err){
      recallCard.innerHTML = `<div class="glass-card metallic-border rounded-2xl p-6 carbon-panel"><h3 class="text-lg font-bold text-white">Recalls</h3><p class="mt-2 text-silver-400 text-sm">Recall service is busy. Try again later.</p></div>`;
      recallCard.classList.remove('hidden');
    }

    ctx = { vin, decoded, recallCount };
    renderActions(vin, decoded, recallCount);
    postBubble(chat, 'ai', "Report ready. Ask anything &mdash; insurance, warranty, repair risk, recalls, or resale.");
  } catch(e){
    setError('Service is busy right now. Please try again shortly.');
  } finally {
    setLoading(false);
  }
}

function renderVehicle(data){
  const fields = [
    ['Year', data.ModelYear],
    ['Make', data.Make],
    ['Model', data.Model],
    ['Trim', data.Trim],
    ['Engine', `${data.DisplacementL || ''}L ${data.EngineConfiguration || ''} ${data.FuelTypePrimary || ''}`.trim()],
    ['Body', data.BodyClass],
    ['Drive', data.DriveType],
    ['Transmission', data.TransmissionStyle || data.TransmissionDescriptor || ''],
    ['Plant', data.PlantCity && data.PlantCountry ? `${data.PlantCity}, ${data.PlantCountry}` : data.PlantCountry || '']
  ].filter(([k,v]) => v && String(v).trim() !== '');

  vehicleCard.innerHTML = `
    <div class="glass-card metallic-border rounded-2xl overflow-hidden glow-cyan-sm animate-in carbon-panel">
      <div class="steel-header px-6 py-4 flex items-center justify-between gap-4">
        <h3 class="text-lg font-bold text-white">Vehicle Specs</h3>
        <span class="text-xs px-3 py-1.5 rounded-lg bg-volt-600/10 border border-volt-500/20 text-volt-400 font-mono tracking-wide">VIN: ${data.VIN || ''}</span>
      </div>
      <div class="px-6 py-5">
        <div class="grid sm:grid-cols-2 md:grid-cols-3 gap-3">
          ${fields.map(([k,v]) => `
            <div class="p-3 rounded-xl bg-white/[0.02] border border-white/[0.05]">
              <div class="text-[10px] font-semibold text-silver-500 uppercase tracking-wider">${k}</div>
              <div class="font-semibold text-white mt-0.5">${v}</div>
            </div>`).join('')}
        </div>
      </div>
    </div>`;
  vehicleCard.classList.remove('hidden');
}

function renderRecalls(recalls){
  if(!recalls || !recalls.results || !recalls.results.length){
    recallCard.innerHTML = `
      <div class="glass-card metallic-border rounded-2xl overflow-hidden animate-in carbon-panel">
        <div class="steel-header px-6 py-4">
          <h3 class="text-lg font-bold text-white">Recalls</h3>
        </div>
        <div class="px-6 py-5">
          <div class="flex items-center gap-2 text-emerald-400 text-sm">
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            No recalls found for the decoded make/model/year.
          </div>
        </div>
      </div>`;
    recallCard.classList.remove('hidden');
    return 0;
  }
  const items = recalls.results.slice(0, 8).map(r => `
    <details class="p-4 rounded-xl bg-amber-500/[0.06] border border-amber-500/20 group">
      <summary class="cursor-pointer font-semibold text-amber-300 flex items-center gap-2">
        <svg class="w-4 h-4 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"/></svg>
        ${r.Component || 'Recall'} &mdash; ${r.ReportReceivedDate || ''}
      </summary>
      <div class="mt-3 text-sm text-silver-400 space-y-1.5 pl-6">
        <div><span class="font-semibold text-silver-300">Summary:</span> ${r.Summary || '—'}</div>
        <div><span class="font-semibold text-silver-300">Consequence:</span> ${r.Conequence || r.Consequence || '—'}</div>
        <div><span class="font-semibold text-silver-300">Remedy:</span> ${r.Remedy || '—'}</div>
        <div><span class="font-semibold text-silver-300">NHTSA #:</span> ${r.NHTSACampaignNumber || '—'}</div>
      </div>
    </details>`).join('');

  recallCard.innerHTML = `
    <div class="glass-card metallic-border rounded-2xl overflow-hidden animate-in carbon-panel">
      <div class="steel-header px-6 py-4">
        <h3 class="text-lg font-bold text-white">Recalls</h3>
      </div>
      <div class="px-6 py-5 space-y-3">${items}</div>
    </div>`;
  recallCard.classList.remove('hidden');
  return recalls.results.length;
}

function renderActions(vin, decoded, recallCount){
  const actions = [
    { label:'Compare insurance rates', key:'insurance', desc:'See top carriers for this vehicle.', icon:'<path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z"/>' },
    { label:'Check warranty options', key:'warranty', desc:'Protection for costly repairs.', icon:'<path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17l-5.1-5.1a1.5 1.5 0 010-2.12l.87-.87a1.5 1.5 0 012.12 0L12 9.75l5.46-5.46a1.5 1.5 0 012.12 0l.87.87a1.5 1.5 0 010 2.12l-5.1 5.1a3.12 3.12 0 01-4.41 0z"/>' },
    { label:'Get loan/refi offers', key:'loans', desc:'Lower payments or finance smart.', icon:'<path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z"/>' },
    { label:'Sell or get instant offer', key:'sell', desc:'See what you could get right now.', icon:'<path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z"/><path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z"/>' },
    { label:'Find mechanic estimates', key:'mechanics', desc:'Find fair prices near you.', icon:'<path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17l-5.1-5.1m0 0l2.12-2.12M6.32 10.07L2.25 14.14M21.75 12a9.75 9.75 0 11-19.5 0 9.75 9.75 0 0119.5 0z"/>' },
    { label:'Lemon-law / defect help', key:'lemonlaw', desc:'If repairs pile up, know your rights.', icon:'<path stroke-linecap="round" stroke-linejoin="round" d="M12 3v17.25m0 0c-1.472 0-2.882.265-4.185.75M12 20.25c1.472 0 2.882.265 4.185.75M18.75 4.97A48.416 48.416 0 0012 4.5c-2.291 0-4.545.16-6.75.47m13.5 0c1.01.143 2.01.317 3 .52m-3-.52l2.62 10.726c.122.499-.106 1.028-.589 1.202a5.989 5.989 0 01-2.031.352 5.989 5.989 0 01-2.031-.352c-.483-.174-.711-.703-.59-1.202L18.75 4.971zm-16.5.52c.99-.203 1.99-.377 3-.52m0 0l2.62 10.726c.122.499-.106 1.028-.589 1.202a5.989 5.989 0 01-2.031.352 5.989 5.989 0 01-2.031-.352c-.483-.174-.711-.703-.59-1.202L5.25 4.971z"/>' }
  ];
  actionsCard.innerHTML = `
    <div class="glass-card metallic-border rounded-2xl overflow-hidden animate-in carbon-panel">
      <div class="steel-header px-6 py-4">
        <h3 class="text-lg font-bold text-white">Recommended Next Steps</h3>
      </div>
      <div class="px-6 py-5">
        <div class="grid sm:grid-cols-2 gap-3">
          ${actions.map(a => `
            <a target="_blank" rel="nofollow sponsored noopener" href="${fillAffiliate(AFFILIATES[a.key], vin)}"
               class="flex items-start gap-3 p-4 rounded-xl bg-white/[0.02] border border-white/[0.05] hover:border-volt-500/30 hover:bg-volt-600/[0.04] transition-all group">
              <svg class="w-5 h-5 text-volt-500 shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">${a.icon}</svg>
              <div>
                <div class="font-semibold text-white text-sm group-hover:text-volt-400 transition-colors">${a.label}</div>
                <div class="text-xs text-silver-500 mt-0.5">${a.desc}</div>
              </div>
            </a>`).join('')}
        </div>
        <p class="mt-4 text-[11px] text-silver-500/50">Affiliate disclosure: We may earn when you click a partner link &mdash; at no cost to you.</p>
      </div>
    </div>`;
  actionsCard.classList.remove('hidden');
}

runBtn.addEventListener('click', runVIN);
vinInput.addEventListener('keydown', e => { if(e.key === 'Enter') runVIN(); });
</script>
</body>
</html>
